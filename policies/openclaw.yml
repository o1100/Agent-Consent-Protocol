# ACP Policy Preset — OpenClaw
#
# In contained mode (--contained), ACP intercepts all outbound network
# traffic from the container. Every HTTP/HTTPS connection is gated by
# domain, regardless of which internal tool initiated it. Local-only
# operations (file read/write, local exec) stay inside the container
# and are bounded by Docker isolation (read-only fs, no capabilities).
#
# MCP tool rules below apply when tools are routed through ACP's MCP
# proxy. In contained mode with openclaw, internal tools bypass the
# MCP proxy but their network traffic is still caught at the HTTP level.

version: "2"
default_action: ask

rules:
  # ── HTTP Rules ──────────────────────────────────
  # (Enforced in both proxy-only and contained mode)

  # Telegram (required for Telegram bots)
  - match: { kind: http, host: "api.telegram.org" }
    action: allow
  - match: { kind: http, host: "*.telegram.org" }
    action: allow

  # LLM providers
  - match: { kind: http, host: "*.anthropic.com" }
    action: allow
  - match: { kind: http, host: "*.openai.com" }
    action: allow

  # Common safe APIs
  - match: { kind: http, host: "*.googleapis.com" }
    action: allow
  - match: { kind: http, host: "api.github.com" }
    action: allow
  - match: { kind: http, host: "api.search.brave.com" }
    action: allow

  # Payment/sensitive domains
  - match: { kind: http, host: "*.stripe.com" }
    action: ask
    level: critical
  - match: { kind: http, host: "*.paypal.com" }
    action: ask
    level: critical

  # All other HTTP — prompt
  - match: { kind: http }
    action: ask

  # ── Shell Rules ─────────────────────────────────
  # (Enforced when shell wrappers are active)

  # Container runtime basics
  - match: { kind: shell, tool: "shell:node" }
    action: allow
  - match: { kind: shell, tool: "shell:bash" }
    action: allow
  - match: { kind: shell, tool: "shell:sh" }
    action: allow

  # Git read-only
  - match: { kind: shell, tool: "shell:git", command: "git status*" }
    action: allow
  - match: { kind: shell, tool: "shell:git", command: "git log*" }
    action: allow
  - match: { kind: shell, tool: "shell:git", command: "git diff*" }
    action: allow

  # All other shell
  - match: { kind: shell }
    action: ask
    level: high

  # ── MCP Tool Rules ─────────────────────────────
  # (Apply when agent routes tools through ACP's MCP proxy)

  # Read operations
  - match: { category: read }
    action: allow

  # Web search
  - match: { tool: web_search }
    action: allow

  # Financial
  - match: { category: financial }
    action: ask
    level: critical
    timeout: 300

  # Safety net
  - match: { tool: "*" }
    action: ask
    rate_limit: 30/minute
