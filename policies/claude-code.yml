# ACP Policy Preset — Claude Code
# Sensible defaults for running Claude Code under ACP.

version: "2"
default_action: ask

rules:
  # ── HTTP Rules ─────────────────────────────────
  # Claude Code API traffic — always allow
  - match: { kind: http, host: "*.anthropic.com" }
    action: allow
  - match: { kind: http, host: "*.claude.ai" }
    action: allow
  - match: { kind: http, host: "*.sentry.io" }
    action: allow

  # ── MCP Tool Rules ─────────────────────────────
  # Read operations are always safe
  - match: { category: read }
    action: allow

  # ── Shell Rules ────────────────────────────────
  # Destructive commands — deny outright
  - match: { kind: shell, command: "rm -rf /*" }
    action: deny
  - match: { kind: shell, command: "rm -rf /" }
    action: deny
  - match: { kind: shell, command: "mkfs*" }
    action: deny
  - match: { kind: shell, command: "dd if=*of=/dev/*" }
    action: deny
  - match: { kind: shell, command: ":(){:|:&};:" }
    action: deny

  # All other shell commands need approval
  - match: { kind: shell }
    action: ask

  # ── HTTP catch-all ─────────────────────────────
  # Unknown hosts need approval
  - match: { kind: http }
    action: ask

  # ── Safety net ─────────────────────────────────
  - match: { tool: "*" }
    action: ask
    rate_limit: 30/minute
