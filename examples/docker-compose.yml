# ACP Docker Compose — Full network isolation
#
# The agent runs in an isolated network with no internet access.
# All traffic goes through ACP, which has internet access for
# upstream MCP servers and Telegram.
#
# Usage:
#   export TELEGRAM_TOKEN=your-bot-token
#   export CHAT_ID=your-chat-id
#   docker compose up

version: "3.8"

services:
  acp:
    image: ghcr.io/o1100/acp:latest
    environment:
      - ACP_CHANNEL=telegram
      - ACP_TELEGRAM_TOKEN=${TELEGRAM_TOKEN}
      - ACP_TELEGRAM_CHAT_ID=${CHAT_ID}
    volumes:
      - ../policies/default.yml:/etc/acp/policy.yml:ro
      - acp-data:/var/lib/acp
    networks:
      - isolated
      - internet
    ports:
      - "127.0.0.1:8443:8443"
    restart: unless-stopped

  agent:
    image: your-agent-image  # Replace with your agent's image
    environment:
      - ACP_PROXY_URL=http://acp:8443
      - MCP_SERVER_URL=http://acp:8443
    depends_on:
      - acp
    networks:
      - isolated  # NO internet access — only reaches ACP
    restart: unless-stopped

networks:
  isolated:
    internal: true  # No external connectivity
  internet:
    # Default: has external connectivity

volumes:
  acp-data:
